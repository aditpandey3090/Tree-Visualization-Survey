<!DOCTYPE html>
<html>
  <head>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="dataModel.js"></script>
    <script src="dataloader.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.15.0/d3.js"></script>
    <link rel="stylesheet" type="text/css" href="chartStyle.css" />

    <!-- <script src="https://spreadsheets.google.com/feeds/cells/1hbHqrnYa4oMUquZcq8WkTJk0kI0t9scGBwro-EH-ALA/1/public/values?alt=json-in-script&callback=doData"></script> -->
    <!-- <script src="https://spreadsheets.google.com/feeds/cells/19TCHAcFTNa_Va6UankLiZiHxvwUmfXnJyJA7B5hsuIs/1/public/values?alt=json-in-script&callback=doData"></script> -->
  </head>

  <body>
    <h1>First Chart</h1>
  </body>
  <script>
    //Test Dataset, this should be replaced with real data
    let data = [
      { year: 2010, val: 3 },
      { year: 2011, val: 4 },
      { year: 2012, val: 5 }
    ];

    //Initialize the dimensions of the chart
    var margin = { top: 20, right: 20, bottom: 30, left: 40 },
      width = 500 - margin.left - margin.right,
      height = 500 - margin.top - margin.bottom;

    //Setup the svg for chart drawing
    var svg = d3
      .select("body")
      .append("svg")
      .attr("class", "chart1") //ToDo:Add a more descriptive classname
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
      .append("g")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    const t = svg.transition().duration(750);

    //Setting up the x and y scale

    function drawBarChart() {
      var data = [
        { year: 2010, val: 3 },
        { year: 2011, val: 4 },
        { year: 2012, val: 5 }
      ];

      // d3.select(".xaxis")
      //   .remove()
      //   .transition(t);

      var x = d3
        .scaleBand()
        .domain(data.map(d => d.year))
        .range([margin.left, width - margin.right])
        .padding(0.1);

      var y = d3
        .scaleLinear()
        .domain([0, d3.max(data, d => d.val)])
        .nice()
        .range([height - margin.bottom, margin.top]);

      xAxis = g =>
        g
          .attr("transform", `translate(0,${height - margin.bottom})`)
          .attr("class", "xaxis")
          .call(d3.axisBottom(x).tickSizeOuter(0));

      yAxis = g =>
        g
          .attr("transform", `translate(${margin.left},0)`)
          .call(d3.axisLeft(y))
          .attr("class", "yaxis")
          .call(g => g.select(".domain").remove());

      const bar = svg
        .selectAll("rect")
        .data(data)
        .join("rect")
        .transition(t)
        .attr("x", d => x(d.year))
        .attr("y", d => y(d.val))
        .attr("height", d => y(0) - y(d.val))
        .attr("width", x.bandwidth());

      const gx = svg.append("g").call(xAxis);
      const gy = svg.append("g").call(yAxis);
    }
    drawBarChart();
    //================================================================================================================//
    var svg1 = d3
      .select("body")
      .append("svg")
      .attr("class", "chart2") //ToDo:Add a more descriptive classname
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
      .append("g")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    function drawLineChart() {
      let x = d3
        .scaleBand()
        .domain(data.map(d => d.year))
        .range([margin.left, width - margin.right])
        .padding(0.1);

      let y = d3
        .scaleLinear()
        .domain([0, d3.max(data, d => d.val)])
        .nice()
        .range([height - margin.bottom, margin.top]);

      let line = d3
        .line()
        .x(function(d, i) {
          return x(d.year);
        }) // set the x values for the line generator
        .y(function(d) {
          return y(d.val);
        }) // set the y values for the line generator
        .curve(d3.curveMonotoneX); // apply smoothing to the line

      xAxis = g =>
        g
          .attr("transform", `translate(0,${height - margin.bottom})`)
          .attr("class", "xaxis")
          .call(d3.axisBottom(x).tickSizeOuter(0));

      yAxis = g =>
        g
          .attr("transform", `translate(${margin.left},0)`)
          .call(d3.axisLeft(y))
          .attr("class", "yaxis")
          .call(g => g.select(".domain").remove());

      const gx = svg1.append("g").call(xAxis);
      const gy = svg1.append("g").call(yAxis);

      svg1
        .append("path")
        .datum(data) // 10. Binds data to the line
        .attr("class", "line") // Assign a class for styling
        .attr("transform", `translate(${margin.left},0)`)
        .attr("d", line); // 11. Calls the line generator

      svg1
        .selectAll(".dot")
        .data(data)
        .join("circle") // Uses the enter().append() method
        .attr("class", "dot") // Assign a class for styling
        .attr("cx", function(d, i) {
          return x(d.year);
        })
        .attr("cy", function(d) {
          return y(d.val);
        })
        .attr("r", 5)
        .attr("transform", `translate(${margin.left},0)`)
        .on("mouseover", function(a, b, c) {
          console.log(a);
          this.attr("class", "focus");
        })
        .on("mouseout", function() {});
    }

    drawLineChart(data);
    data.push({ year: 2013, val: 5 });
    setTimeout(function() {
      drawLineChart(data);
    }, 2000);
    //================================================================================================================//
  </script>
</html>
